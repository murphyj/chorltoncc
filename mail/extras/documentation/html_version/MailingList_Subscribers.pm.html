<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>DADA::MailingList::Subscribers</title>
<link rel="stylesheet" href="/Users/justin/Documents/DadaMail/build/tmp/dada/extras/documentation/pod_source/pod_styles.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:_postfix@neige.apple.com" />
</head>

<body>


<!-- INDEX BEGIN -->
<div name="index">
<p><a name="__index__"></a></p>

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<ul>

		<li><a href="#subscription_list_model">Subscription List Model</a></li>
		<ul>

			<li><a href="#a_subscriber_is_mostly_identified_by_their_email_address">A subscriber is mostly identified by their email address</a></li>
			<li><a href="#the_subscription_list_is_made_up_of_sublists_">The Subscription List is made up of Sublists.</a></li>
			<li><a href="#a_subscription_list_can_have_subscriber_profile_fields">A Subscription List can have Subscriber Profile Fields</a></li>
			<li><a href="#restrictions_are_enforced_by_dada_mail_to_only_allow_correct_information_to_be_saved_in_the_subscription_list">Restrictions are enforced by Dada Mail to only allow correct information to be saved in the Subscription List</a></li>
			<li><a href="#the_subscription_list_has_various_backend_options">The Subscription List has various backend options</a></li>
		</ul>

	</ul>

	<li><a href="#public_methods">Public Methods</a></li>
	<ul>

		<li><a href="#initializing">Initializing</a></li>
		<li><a href="#new">new</a></li>
		<li><a href="#add_get_edit_move_copy_remove_a_subscriber">Add/Get/Edit/Move/Copy/Remove a Subscriber</a></li>
		<li><a href="#add_subscriber">add_subscriber</a></li>
		<ul>

			<li><a href="#diagnostics">Diagnostics</a></li>
		</ul>

		<li><a href="#get_subscriber">get_subscriber</a></li>
		<ul>

			<li><a href="#diagnostics">Diagnostics</a></li>
		</ul>

		<li><a href="#edit_subscriber">edit_subscriber</a></li>
		<ul>

			<li><a href="#diagnostics">Diagnostics</a></li>
		</ul>

		<li><a href="#move_subscriber">move_subscriber</a></li>
		<ul>

			<li><a href="#diagnostics">Diagnostics</a></li>
		</ul>

		<li><a href="#copy_subscriber">copy_subscriber</a></li>
		<ul>

			<li><a href="#diagnostics">Diagnostics</a></li>
		</ul>

		<li><a href="#remove_subscriber">remove_subscriber</a></li>
		<ul>

			<li><a href="#diagnostics">Diagnostics</a></li>
		</ul>

		<li><a href="#validating_a_subscriber">Validating a Subscriber</a></li>
		<li><a href="#get_list_types">get_list_types</a></li>
		<li><a href="#check_for_double_email">check_for_double_email</a></li>
		<li><a href="#subscription_check">subscription_check</a></li>
		<li><a href="#subscription_check_xml">subscription_check_xml</a></li>
		<li><a href="#unsubscription_check">unsubscription_check</a></li>
		<li><a href="#add_get_edit_remove_a_subscription_field">Add/Get/Edit/Remove a Subscription Field</a></li>
		<li><a href="#filter_subscribers">filter_subscribers</a></li>
		<li><a href="#filter_subscribers_w_meta">filter_subscribers_w_meta</a></li>
		<li><a href="#add_subscriber_field">add_subscriber_field</a></li>
		<ul>

			<li><a href="#diagnostics">Diagnostics</a></li>
		</ul>

		<li><a href="#subscriber_fields">subscriber_fields</a></li>
		<ul>

			<li><a href="#diagnostics">Diagnostics</a></li>
		</ul>

		<li><a href="#edit_subscriber_field">edit_subscriber_field</a></li>
		<ul>

			<li><a href="#diagnostics">Diagnostics</a></li>
		</ul>

		<li><a href="#remove_subscriber_field">remove_subscriber_field</a></li>
		<ul>

			<li><a href="#diagnostics">Diagnostics</a></li>
		</ul>

		<li><a href="#subscriber_field_exists">subscriber_field_exists</a></li>
		<ul>

			<li><a href="#diagnostics">Diagnostics</a></li>
		</ul>

		<li><a href="#validate_subscriber_field_name">validate_subscriber_field_name</a></li>
		<ul>

			<li><a href="#subscriber_validation_requirements">Subscriber Validation Requirements</a></li>
		</ul>

		<li><a href="#validate_remove_subscriber_field_name">validate_remove_subscriber_field_name</a></li>
		<li><a href="#get_all_field_attributes">get_all_field_attributes</a></li>
		<li><a href="#_save_field_attributes">_save_field_attributes</a></li>
		<ul>

			<li><a href="#diagnostics">Diagnostics</a></li>
		</ul>

		<li><a href="#remove_field_attributes">remove_field_attributes</a></li>
		<ul>

			<li><a href="#diagnostics">Diagnostics</a></li>
		</ul>

	</ul>

	<li><a href="#author">AUTHOR</a></li>
	<li><a href="#licence_and_copyright">LICENCE AND COPYRIGHT</a></li>
</ul>

<hr name="index" />
</div>
<!-- INDEX END -->

<p>
</p>
<hr />
<h1><a name="name">NAME</a></h1>
<p>DADA::MailingList::Subscribers - API for the Dada Mailing List Subscribers</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<pre>
 # Import
 use Dada::MailingList::Subscribers; 
  
 # Create a new object
 my $lh = DADA::MailingList::Subscribers-&gt;new({-list =&gt; 'mylist'}); 
 
 # Check if this can be a valid subscription: 
 
 my ($status, $errors) = $lh-&gt;subscription_check(
        {
                -email =&gt; 'user@example.com', 
        }
 );
 
 # How about to unsubscribe: 
 
 my ($status, $errors) = $lh-&gt;unsubscription_check(
        {
                -email =&gt; 'user@example.com', 
        }
  );
 
 # Add
 $lh-&gt;add_subscriber(
        {
                -email =&gt; 'user@example.com',
                -type  =&gt; 'list', 
        }
 );
 
 # Move
 $lh-&gt;move_subscriber(
        {
                -email =&gt; 'user@example.com',
                -from  =&gt; 'list', 
                -to    =&gt; 'black_list', 
        }
  );
 
 # Copy
 $lh-&gt;copy_subscriber(
        {
                -email =&gt; 'user@example.com',
                -from  =&gt; 'black_list', 
                -to    =&gt; 'list', 
        }
  );
 
 # Remove
 $lh-&gt;remove_subscriber(
        {
                -email =&gt; 'user@example.com',
                -type  =&gt; 'list', 
        }
  );</pre>
<p>
</p>
<hr />
<h1><a name="description">DESCRIPTION</a></h1>
<p>This module represents the API for Dada Mail's subscriptions lists.</p>
<p>
</p>
<h2><a name="subscription_list_model">Subscription List Model</a></h2>
<p>Dada Mail's Subscription List system is currently fairly simple:</p>
<p>
</p>
<h3><a name="a_subscriber_is_mostly_identified_by_their_email_address">A subscriber is mostly identified by their email address</a></h3>
<p>Usually, when we talk of a, &quot;Subscriber&quot;, we're talking about a email address that has been included
in a Dada Mail Subscription List.</p>
<p>
</p>
<h3><a name="the_subscription_list_is_made_up_of_sublists_">The Subscription List is made up of Sublists.</a></h3>
<p>A sublist is a list of subscribers. Each sublist is completely separated from each other sublist.</p>
<p>Each sublist is known because of its type.</p>
<p>The types of sublists are as follows:</p>
<ul>
<li><strong><a name="list" class="item">list</a></strong>

<p>This is your main subscription list and is the most important type of sublist. It holds a Mailing List's <strong>subscribers</strong>. 
When a mailing list message is sent out, this is the list whose addresses are used.</p>
</li>
<li><strong><a name="black_list" class="item">black_list</a></strong>

<p>This is the sublist of addresses that are not allowed to join the sublist, <strong>list</strong></p>
<p>The addresses in this sublist do not have to be fully qualified email addresses, 
but can be simple strings, which are then used to match on other addresses, 
for verification.</p>
</li>
<li><strong><a name="white_list" class="item">white_list</a></strong>

<p>This is the sublist of addresses that are allowed to join the sublist, <strong>list</strong></p>
<p>The addresses in this sublist do not have to be fully qualified email addresses, 
but can be simple strings, which are then used to match on other addresses, 
for verification.</p>
</li>
<li><strong><a name="authorized_senders" class="item">authorized_senders</a></strong>

<p>This is the sublist of addresses that can be allowed to post to a mailing list, from an email client, via the 
<strong>Dada Bridge</strong> plugin, if this feature has been enabled.</p>
</li>
<li><strong><a name="sub_confirm_list" class="item">sub_confirm_list</a></strong>

<p>This is the sublist that keeps subscription information on potential subscribers, 
when they've asked to join a list, but have not yet been verified via an email 
confirmation to subscribe.</p>
</li>
<li><strong><a name="unsub_confirm_list" class="item">unsub_confirm_list</a></strong>

<p>This is the sublist that keeps unsubscription information on potential unsubscribers, 
when they've asked to leave a list, but have not yet been verified via an email 
confirmation to unsubscribe.</p>
</li>
<li><strong><a name="invitelist" class="item">invitelist</a></strong>

<p>This is a sublist of temporary subscribers, who've been invited to join a mailing list. 
It's only used internally and is removed shortly after sending out a list invitation has begun.</p>
</li>
</ul>
<p>
</p>
<h3><a name="a_subscription_list_can_have_subscriber_profile_fields">A Subscription List can have Subscriber Profile Fields</a></h3>
<p>The Subscriber Profile Fields are information that's separate than the email address of a subscriber. 
Their values are arbitrary and can be set to most anything you'd like.</p>
<p>Internally, the Subscriber Profile Fields are mapped almost exactly to SQL columns - adding a subscriber 
field will add a column in an SQL table. Removing a field will remove a column.</p>
<p>
</p>
<h3><a name="restrictions_are_enforced_by_dada_mail_to_only_allow_correct_information_to_be_saved_in_the_subscription_list">Restrictions are enforced by Dada Mail to only allow correct information to be saved in the Subscription List</a></h3>
<p>The most obvious enforcement is that the subscriber has to have a valid email address.</p>
<p>Another enforcement is that a subscriber cannot be subscribed to a sublist twice.</p>
<p>A subscriber can be on more than one sublist at the same time.</p>
<p>Some sublists are used to enforce subscription on other sublists. For example, a subscriber in the <strong>black_list</strong> 
sublist will not be allowed to joing the, <strong>list</strong> sublist.</p>
<p>These enforcements are currently lazy - You <em>can</em> easily break these rules, but you don't want to, 
and checking the validation of a subscriber is easy. The easiest way to break these rules is to work with the backend that 
the subscribers are saved in directly.</p>
<p>
</p>
<h3><a name="the_subscription_list_has_various_backend_options">The Subscription List has various backend options</a></h3>
<p>The Subscription List can either be saved as a series of PlainText files (one file for each type of sublist), 
or as an SQL table.</p>
<p>Each type of backend has different features that are available. The most notable feature is that the SQL 
backend supports arbitrary Subscriber Profile Fields and the PlainText backend does not.</p>
<p>Currently, the following SQL flavors are supported:</p>
<ul>
<li><strong><a name="mysql" class="item">MySQL</a></strong>

<li><strong><a name="postgresql" class="item">PostgreSQL</a></strong>

<li><strong><a name="sqlite" class="item">SQLite</a></strong>

</ul>
<p>Except for being able to change the name of a Subscriber Field in SQLite, every SQL flavor has the same feature set.</p>
<p>
</p>
<hr />
<h1><a name="public_methods">Public Methods</a></h1>
<p>Below are the list of <em>Public</em> methods that we recommend using when manipulating a Dada Mail Subscription List:</p>
<p>Every method has its paramaters, if required (and when it's stated that they're required, <em>they are</em>), passed as a hashref.</p>
<p>
</p>
<h2><a name="initializing">Initializing</a></h2>
<p>
</p>
<h2><a name="new">new</a></h2>
<pre>
 my $lh = DADA::MailingList::Subscribers-&gt;new({-list =&gt; 'mylist'});</pre>
<p><code>new</code> requires you to pass a <strong>listshortname</strong> in, <a href="#list"><code>-list</code></a>. If you don't, your script will die.</p>
<p>A <code>DADA::MailingList::Subscribers</code> object will be returned.</p>
<p>
</p>
<h2><a name="add_get_edit_move_copy_remove_a_subscriber">Add/Get/Edit/Move/Copy/Remove a Subscriber</a></h2>
<p>
</p>
<h2><a name="add_subscriber">add_subscriber</a></h2>
<pre>
 $lh-&gt;add_subscriber(
        {
                -email  =&gt; 'user@example.com', 
                -type   =&gt; 'list',
                -fields =&gt; {
                                        # ...
                                   },
        }
);</pre>
<p><code>add_subscriber</code> adds a subscriber to a sublist.</p>
<p><a href="#email"><code>-email</code></a> is required and should hold a valid email address in form of: <code>user@example.com</code></p>
<p><code>-type</code> holds the sublist you want to subscribe the address to, if no sublist is passed, <strong>list</strong> is used as a default.</p>
<p><code>-fields</code> holds the subscription fields you'd like associated with the subscription, passed as a hashref.</p>
<p>For example, if you have two fields, <strong>first_name</strong> and, <strong>last_name</strong>, you would pass the Subscriber Profile Fields like this:</p>
<pre>
 $lh-&gt;add_subscriber(
        {
                -email  =&gt; 'user@example.com', 
                -type   =&gt; 'list',
                -fields =&gt; {
                                        first_name =&gt; &quot;John&quot;, 
                                        last_name  =&gt; &quot;Doe&quot;, 
                                   },
        }
 );</pre>
<p>Passing field values is optional.</p>
<p>Fields that are not actual fields that are being passed will be ignored.</p>
<p><code>-dupe_check</code> can also be optionally passed. It should contain a hashref with other 
options. For example:</p>
<p><table cellspacing="0" cellpadding="0"><tr><td>$lh-&gt;add_subscriber(
<tr><td><td>{
<tr><td><td>-email  =&gt; <a href="mailto:'user@example.com',">'user@example.com',</a> 
<tr><td><td>-type   =&gt; 'list',
<tr><td><td>-fields =&gt; {
<tr><td><td>first_name =&gt; &quot;John&quot;, 
<tr><td><td>last_name  =&gt; &quot;Doe&quot;, 
<tr><td><td>   },
<tr><td><td>}, 
<tr><td><td>-dupe_check    =&gt; {
<tr><td><td>-enable  =&gt; 1,
<tr><td><td>-on_dupe =&gt; 'ignore_add',
<tr><td><td>},</table></p>
<pre>

);</pre>
<p><code>-enable</code> can either be set to, <code>1</code> or, <code>0</code>. <code>1</code> enables the check for dupes, right 
before subscribing an address. <code>0</code> ignores the dupe check, so don't set it to <code>0</code></p>
<p><code>-on_dupe</code> may be set to, <code>ignore_add</code> to simply ignore subscribing the address. A warning will
be logged in the error log. You may also set this to, <code>error</code>, which will cause the program to die.</p>
<p>Setting this to anything else will cause the program to die. Forgetting to set it will have it default to, <code>ignore_add</code>.</p>
<p>If the Duplicate subscriber check fails, (and <code>-on_dupe</code> is set to, <code>ignore_add</code> this method
will return, <code>0</code> and not a DADA::MailingList::Subscriber object.</p>
<p>
</p>
<h3><a name="diagnostics">Diagnostics</a></h3>
<ul>
<li><strong><a name="you_must_pass_an_email_in_the_email_paramater" class="item">You must pass an email in the -email paramater!</a></strong>

<p>You forgot to pass an email in the, -email paramater, ie:</p>
<pre>
 # DON'T do this:
 $lh-&gt;add_subscriber();</pre>
</li>
<li><strong><a name="statement" class="item">cannot do statement (at add_subscriber)!</a></strong>

<p>Something went wrong in the SQL side of things.</p>
</li>
</ul>
<p><strong>returns</strong> a DADA::MailingList::Subscriber object on success, <code>undef</code> or croaks on failure.</p>
<p>
</p>
<h2><a name="get_subscriber">get_subscriber</a></h2>
<pre>
 my $sub_info = $lh-&gt;get_subscriber(
                {
                        -email =&gt; 'user@example.com', 
                        -type  =&gt; 'list', 
                }
        );</pre>
<p>Returns the Subscriber Profile Fields information in the form of a hashref.</p>
<p><a href="#email"><code>-email</code></a> is required and should hold a valid email address in form of: <code>user@example.com</code>. The address should also be subscribed
and no check is done if the address you passed isn't.</p>
<p><code>-type</code> holds the sublist you want to work with. If no sublist is passed, <strong>list</strong> is used as a default.</p>
<p>
</p>
<h3><a name="diagnostics">Diagnostics</a></h3>
<ul>
<li><strong><a name="you_must_pass_an_email_in_the_email_paramater2" class="item">You must pass an email in the -email paramater!</a></strong>

<p>You forgot to pass an email in the, -email paramater, ie:</p>
<pre>
 # DON'T do this:
 $lh-&gt;get_subscriber();</pre>
</li>
<li><strong>cannot do statement (at get_subscriber)!</strong>

<p>Something went wrong in the SQL side of things.</p>
</li>
</ul>
<p>
</p>
<h2><a name="edit_subscriber">edit_subscriber</a></h2>
<pre>
 $lh-&gt;edit_subscriber(
        {
                -email  =&gt; 'user@example.com', 
                -type   =&gt; 'list', 
                -fields =&gt; 
                        {
                                # ...
                        },
                -method =&gt; 'writeover',
        }
 );</pre>
<p>returns <code>1</code> on success.</p>
<p>Internally, this method removes a subscriber and adds the same subscriber again to the same list.</p>
<p><a href="#email"><code>-email</code></a> is required and should hold a valid email address in form of: <code>user@example.com</code></p>
<p><code>-type</code> holds the sublist you want to subscribe the address to, if no sublist is passed, <strong>list</strong> is used as a default.</p>
<p><code>-fields</code> holds the subscription fields you'd like associated with the subscription, passed as a hashref.</p>
<p>For example, if you have two fields, <strong>first_name</strong> and, <strong>last_name</strong>, you would pass the Subscriber Profile Fields like this:</p>
<pre>
 $lh-&gt;edit_subscriber(
        {
                -email  =&gt; 'user@example.com', 
                -type   =&gt; 'list',
                -fields =&gt; {
                                        first_name =&gt; &quot;Jon&quot;, 
                                        last_name  =&gt; &quot;Doh&quot;, 
                                   },
        }
 );</pre>
<p>Passing field values is optional, although you probably would want to, as this is the point of the entire method.</p>
<p>Fields that are not actual fields that are being passed will be ignored.</p>
<p><code>-method</code> holds the type of editing you want to do. Currently, this can be either, <code>update</code>, or, <code>writeover</code>.</p>
<p><code>update</code> will only save the fields you pass - any other fields saved for this subscriber will not be erased.</p>
<p><code>writeover</code> will save only the fields you pass - any other fields will be removed from the subscriber.</p>
<p>If no <code>-method</code> is passed, <strong>update</strong> is used as a default.</p>
<p>
</p>
<h3><a name="diagnostics">Diagnostics</a></h3>
<p>Internally, the subscriber is first removed, than added, using the <code>add_subscriber</code> and, <code>remove_subscriber</code> methods. 
Those diagnostics may pop up, if you use this method incorrectly</p>
<ul>
<li><strong><a name="the_mode_paramater_must_be_set_to_update_writeover_or_left_undefined" class="item">The -mode paramater must be set to, 'update', 'writeover' or left undefined!</a></strong>

<p>You didn't set the -mode paramater correctly.</p>
</li>
</ul>
<p>
</p>
<h2><a name="move_subscriber">move_subscriber</a></h2>
<pre>
 $lh-&gt;move_subscriber(
        {
                -email =&gt; 'user@example.com', 
                -from  =&gt; 'list', 
                -to    =&gt; 'black_list',
        }
 );</pre>
<p><a href="#email"><code>-email</code></a> holds the email address of the subscriber you want to move.</p>
<p><code>-from</code> holds the sublist you're moving from.</p>
<p><code>-to</code> holds the sublist you're moving to.</p>
<p>All paramaters are required. No other paramaters will be honored.</p>
<p>This method will <code>die</code> if the subscriber isn't actually subscribed to the sublist set in, <code>-from</code> or, 
<strong>is</strong> already subscribed in the sublist set in, <code>-to</code>.</p>
<p>
</p>
<h3><a name="diagnostics">Diagnostics</a></h3>
<ul>
<li><strong><a name="email_passed_in_email_is_not_subscribed_to_list_passed_in_from" class="item">email passed in, -email is not subscribed to list passed in, '-from'</a></strong>

<p>The subscriber isn't actually subscribed to the sublist set in, <code>-from</code></p>
</li>
<li><strong><a name="email" class="item">email passed in, -email ( ) is already subscribed to list passed in, '-to'</a></strong>

<p>The Subscriber is already subscribed in the sublist set in, <code>-to</code>.</p>
</li>
<li><strong><a name="list_type_passed_in_to_is_not_valid" class="item">list_type passed in, -to is not valid</a></strong>

<li><strong><a name="list_type_passed_in_from_is_not_valid" class="item">list_type passed in, -from is not valid</a></strong>

<li><strong><a name="email_passed_in_email_is_not_valid" class="item">email passed in, -email is not valid</a></strong>

<li><strong>cannot do statement (at move_subscriber)!</strong>

<p>Something went wrong in the SQL side of things.</p>
</li>
</ul>
<p>
</p>
<h2><a name="copy_subscriber">copy_subscriber</a></h2>
<pre>
 $lh-&gt;copy_subscriber(
        {
                -email =&gt; 'user@example.com', 
                -from  =&gt; 'list', 
                -to    =&gt; 'black_list',
        }
 );</pre>
<p><a href="#email"><code>-email</code></a> holds the email address of the subscriber you want to copy.</p>
<p><code>-from</code> holds the sublist you're copying from.</p>
<p><code>-to</code> holds the sublist you're copying to.</p>
<p>All paramaters are required. No other paramaters will be honored.</p>
<p>This method will <code>die</code> if the subscriber isn't actually subscribed to the sublist set in, <code>-from</code> or, 
<strong>is</strong> already subscribed in the sublist set in, <code>-to</code>.</p>
<p>
</p>
<h3><a name="diagnostics">Diagnostics</a></h3>
<ul>
<li><strong><a name="email_passed_in_email_is_not_subscribed_to_list_passed_in_from2" class="item">email passed in, -email is not subscribed to list passed in, '-from'</a></strong>

<p>The subscriber isn't actually subscribed to the sublist set in, <code>-from</code></p>
</li>
<li><strong>email passed in, -email ( ) is already subscribed to list passed in, '-to'</strong>

<p>The Subscriber is already subscribed in the sublist set in, <code>-to</code>.</p>
</li>
<li><strong><a name="list_type_passed_in_to_is_not_valid2" class="item">list_type passed in, -to is not valid</a></strong>

<li><strong><a name="list_type_passed_in_from_is_not_valid2" class="item">list_type passed in, -from is not valid</a></strong>

<li><strong><a name="email_passed_in_email_is_not_valid2" class="item">email passed in, -email is not valid</a></strong>

<li><strong>cannot do statement (at move_subscriber)!</strong>

<p>Something went wrong in the SQL side of things.</p>
</li>
</ul>
<p>
</p>
<h2><a name="remove_subscriber">remove_subscriber</a></h2>
<pre>
 $lh-&gt;remove_subscriber(
        {
                -email =&gt; 'user@example.com', 
                -type  =&gt; 'list', 
        }
 );</pre>
<p><code>remove_subscriber</code> removes a subscriber from a sublist.</p>
<p><a href="#email"><code>-email</code></a> is required and should hold a valid email address in form of: <code>user@example.com</code></p>
<p><code>-type</code> holds the sublist you want to subscribe the address to, if no sublist is passed, <strong>list</strong> is used as a default.</p>
<p>No other paramaters are honored.</p>
<p>
</p>
<h3><a name="diagnostics">Diagnostics</a></h3>
<ul>
<li><strong><a name="you_must_pass_an_email_in_the_email_paramater3" class="item">You must pass an email in the -email paramater!</a></strong>

<p>You forgot to pass an email in the, -email paramater, ie:</p>
<pre>
 # DON'T do this:
 $lh-&gt;remove_subscriber();</pre>
</li>
</ul>
<p>
</p>
<h2><a name="validating_a_subscriber">Validating a Subscriber</a></h2>
<p>
</p>
<h2><a name="get_list_types">get_list_types</a></h2>
<pre>
 my $list_types = $lh-&gt;get_list_types</pre>
<p>Returns a hashref of the allowed sublist types. The keys are the actual sublist types, the value is simply set to, <code>1</code>, for 
easy lookup tabling.</p>
<p>Takes no paramaters.</p>
<p>The current list of allowed sublist types are:</p>
<ul>
<li><strong>list</strong>

<li><strong>black_list</strong>

<li><strong>authorized_senders</strong>

<li><strong><a name="testers" class="item">testers</a></strong>

<li><strong>white_list</strong>

<li><strong>sub_confirm_list</strong>

<li><strong>unsub_confirm_list</strong>

<li><strong>invitelist</strong>

</ul>
<p>
</p>
<h2><a name="check_for_double_email">check_for_double_email</a></h2>
<p><strong>Note!</strong> The naming, coding and paramater style is somewhat old and crufty and this method is on the chopping block for a re-write</p>
<pre>
 my $is_subscribed = $lh-&gt;check_for_double_email(
        -Email          =&gt; 'user@example.com,
        -Type           =&gt; 'list',
        -Match_Type     =&gt; 'sublist_centric',
        );</pre>
<p>Returns <strong>1</strong> if the email address passed in, <code>-Email</code> is subscribed to the sublist passed in, <code>-Type</code>.</p>
<p><code>-Email</code> should hold a string that <em>usually</em> is an email address, although can be only a part of an email address.</p>
<p><code>-Type</code> should hold a valid sublist name.</p>
<p><code>-Type</code> will default to, <a href="#list"><code>list</code></a> if no <code>-Type</code> is passed.</p>
<p><code>-Status</code></p>
<p><code>-Match_Type</code> controls the behavior of how a email address is looked for and is usualy something you want to override for the, <a href="#black_list"><code>black_list</code></a> and <a href="#white_list"><code>white_list</code></a> sublists.</p>
<p>The sublists have different matching behaviors. For example, if, <code>bad</code> is subscribed to the <a href="#black_list"><code>black_list</code></a> sublist, this will return <code>1</code></p>
<pre>
 my $is_subscribed = $lh-&gt;check_for_double_email(
        -Email          =&gt; 'bad@example.com,
        -Type           =&gt; 'list',
        -Match_Type     =&gt; 'sublist_centric',
        );</pre>
<p>Since the black list is not simply a list of addresses that are black listed, it's a list of patterns that are black listed.</p>
<p><code>-Match_Type</code> can also be set to, <code>exact</code>, in which case, this would return, <code>0</code></p>
<pre>
 my $is_subscribed = $lh-&gt;check_for_double_email(
        -Email          =&gt; 'bad@example.com,
        -Type           =&gt; 'list',
        -Match_Type     =&gt; 'exact',
        );</pre>
<p><code>-Match_Type</code> will default to, <code>sublist_centric</code> id no <code>-Math_Type</code> is passed.</p>
<p>
</p>
<h2><a name="subscription_check">subscription_check</a></h2>
<pre>
        my ($status, $errors) =  $lh-&gt;subscription_check(
                {
                        -email =&gt; 'user@example.com', 
                        -type  =&gt; 'list'
                        -skip  =&gt; []
                }
        );</pre>
<p><a href="#email"><code>-email</code></a> holds the address you'd like to validate. It is required.</p>
<p><code>-type</code> holds the sublist you want to work on. If not passed, <a href="#list"><code>list</code></a> will be used as the default.</p>
<p><code>-skip</code> holds an arrary ref of checks you'd like not to have done. The checks are named the same as the errors.</p>
<p>For example:</p>
<pre>
 my ($status, $errors) = $lh-&gt;subscription_check(
                                                                {
                                -email =&gt; 'user@example.com', 
                                                -skip =&gt; [qw(black_listed closed_list)],
                                }
                                                        );</pre>
<p>This method returns an array with two elements.</p>
<p>The first element is the status of the validation. <strong>1</strong> will be set if the validation was successful, <strong>0</strong> if there was
an error.</p>
<p>The second element is a list of the errors that were found when validating, in the form of a hashref, with its name
as the name of the error and the value set to, <strong>1</strong> if that error was found.</p>
<p>The errors, which are fairly self-explainitory are as follows:</p>
<ul>
<li><strong><a name="invalid_email" class="item">invalid_email</a></strong>

<li><strong><a name="subscribed" class="item">subscribed</a></strong>

<li><strong><a name="closed_list" class="item">closed_list</a></strong>

<li><strong><a name="mx_lookup_failed" class="item">mx_lookup_failed</a></strong>

<li><strong><a name="black_listed" class="item">black_listed</a></strong>

<li><strong><a name="not_white_listed" class="item">not_white_listed</a></strong>

<li><strong><a name="over_subscription_quota" class="item">over_subscription_quota</a></strong>

<li><strong><a name="already_sent_sub_confirmation" class="item">already_sent_sub_confirmation</a></strong>

<li><strong><a name="settings_possibly_corrupted" class="item">settings_possibly_corrupted</a></strong>

<li><strong><a name="no_list" class="item">no_list</a></strong>

</ul>
<p>Unless you have a special case, always use this method to validate an email subscription.</p>
<p>
</p>
<h2><a name="subscription_check_xml">subscription_check_xml</a></h2>
<pre>
        my ($xml, $status, $errors) =  $lh-&gt;subscription_check_xml({-email =&gt; $email});</pre>
<p>Same as <strong>subscription_check</strong> but also returns an simplified XML-esque document describing the same 
thing.This was initially used to talk to Adobe Flash Apps. It hasn't been updated in a while.</p>
<p>The XML-esque doc is as so:</p>
<pre>
 &lt;subscription&gt;
  &lt;email&gt;some@where.com&lt;/email&gt;
  &lt;status&gt;1&lt;/status&gt;
  &lt;errors&gt;
   &lt;error&gt;no_list&lt;/error&gt;
  &lt;/errors&gt;
 &lt;/subscription&gt;</pre>
<p>
</p>
<h2><a name="unsubscription_check">unsubscription_check</a></h2>
<pre>
 my ($status, $errors) =  $lh-&gt;unsubscription_check(
                                                                {
                                                                        -email =&gt; 'user@example.com',
                                                                        -type  =&gt; 'list', 
                                                                        -skip  =&gt; [],
                                                                        
                                                                }
                                                   );</pre>
<p>Like the subscription_check method, this method returns a $status and a hashref of $%errors
when checking the validity of an unsubscription. The following errors may be returned:</p>
<ul>
<li><strong>no_list</strong>

<li><strong>invalid_email</strong>

<li><strong><a name="not_subscribed" class="item">not_subscribed</a></strong>

<li><strong>settings_possibly_corrupted</strong>

<li><strong><a name="already_sent_unsub_confirmation" class="item">already_sent_unsub_confirmation</a></strong>

</ul>
<p>Again, any of these tests can be skipped using the -skp argument.</p>
<p>
</p>
<h2><a name="add_get_edit_remove_a_subscription_field">Add/Get/Edit/Remove a Subscription Field</a></h2>
<p>As noted, Subscriber Profile Fields are only available in the SQL backends.</p>
<p>It should be also noted that future revisions of Dada Mail may see these types of methods in their own object, ie:</p>
<p><code>DADA::MailingList::Subscribers::Fields</code></p>
<p>or, whatever.</p>
<p>
</p>
<h2><a name="filter_subscribers">filter_subscribers</a></h2>
<pre>
 my (
        $subscribed, 
        $not_subscribed, 
        $black_listed, 
        $not_white_listed, 
        $invalid
        ) = $lh-&gt;filter_subscribers(
                {
                        -emails =&gt; [], 
                        -type   =&gt; 'list',
                }
        );</pre>
<p>This is a very powerful and complex method. There's dragons in the code, but the API is pretty simple.</p>
<p>Used to validated a large amount of addresses at one time. Similar to <code>subscripton_check</code> but is meant for more than one
address. It's also meant to be  bit faster than looping a list of addresses through <code>subscripton_check</code>.</p>
<p>Accepts two paramaters.</p>
<p><a href="#email"><code>-email</code></a> is an array ref of email addresses .</p>
<p><code>-type</code> is the sublist we want to validate undef.</p>
<p>Depending on the type of sublist we're working on, validation works slightly different.</p>
<p>Returns a 5 element array, each element contains an array ref of email addresses.</p>
<p>This method also sets the precendence of black listed and white listed addresses, since an address can be a member of both sublists.</p>
<p>The precendence is the same as what's returned:</p>
<ul>
<li><strong>black_list</strong>

<li><strong>white_list</strong>

<li><strong><a name="invalid" class="item">invalid</a></strong>

</ul>
<p>In other words, if someone is both black listed and white listed, during validation, it'll be returned that they're black listed.</p>
<p>
</p>
<h2><a name="filter_subscribers_w_meta">filter_subscribers_w_meta</a></h2>
<pre>
 my (
        $subscribed, 
        $not_subscribed, 
        $black_listed, 
        $not_white_listed, 
        $invalid
     ) = $lh-&gt;filter_subscribers_w_meta(
                {
                        -emails =&gt; [], 
                        -type   =&gt; 'list',
                }
        );</pre>
<p>Similar to <code>filter_subscribers</code>, but allows you to pass the subscriber field information with the email address.</p>
<p>The, <a href="#email"><code>-email</code></a> paramater should hold an arrayref of hashrefs, instead of just an array ref. The hashref itself should have the form of:</p>
<pre>
 {
        -email =&gt; 'user@example.com',
        -fields =&gt; { 
                -field1 =&gt; 'blah', 
                -field2 =&gt; 'blahblah', 
        }
 }</pre>
<p>No validation is done on the Subscriber Profile Fields - they're simply passed through and returned.</p>
<p>Returns a 5 element array of hashrefs, in the same format as what's passed.</p>
<p>
</p>
<h2><a name="add_subscriber_field">add_subscriber_field</a></h2>
<pre>
 $lh-&gt;add_subscriber_field(
        -field          =&gt; 'myfield', 
        -fallback_value =&gt; 'My Fallback Value', 
 );</pre>
<p><code>add_subscriber_field</code> adds a new subscriber field.</p>
<p><code>-field</code> Should hold the name of the subscriber field you'd like to add. It is required.</p>
<p><code>-fallback_value</code> holds what's known as the, <strong>fallback value</strong>, which is a value used in some instances of Dada Mail, 
if no value is saved in this field for a particular subscriber. It is optional.</p>
<p>
</p>
<h3><a name="diagnostics">Diagnostics</a></h3>
<ul>
<li><strong><a name="you_must_pass_a_value_in_the_field_paramater" class="item">You must pass a value in the -field paramater!</a></strong>

<p>You forget to name your new field.</p>
</li>
<li><strong><a name="pass" class="item">Something's wrong with the field name you're trying to pass (yourfieldname). Validate the field name before attempting to add the field with, 'validate_subscriber_field_name'
You forgot to validate the field name you passed in, <code>-field</code>.</a></strong>

<p>This will only be a warning and won't be fatal.</p>
<p>This error should actually be followed by more warnings, looking like this:</p>
<p><code>Field Error:</code></p>
<p>Which will tell you exactly which test you failed.</p>
</li>
<li><strong>cannot do statement (at add_subscriber_field)!</strong>

<p>Something went wrong in the SQL side of things.</p>
</li>
</ul>
<p>
</p>
<h2><a name="subscriber_fields">subscriber_fields</a></h2>
<pre>
 my $fields = $lh-&gt;subscriber_fields;
 
 # or: 
 
 for(@{$lh-&gt;subscriber_fields}){
  # ... 
 }</pre>
<p>Returns the Subscriber Profile Fields in the Subscription List, in the form of an array ref.</p>
<p>Takes no arguments... usually.</p>
<p>Internally (and privately), it does accept the, <code>-dotted</code> paramater. This will prepend, 'subscriber.' to every field name.</p>
<p>
</p>
<h3><a name="diagnostics">Diagnostics</a></h3>
<p>None that I can think of.</p>
<p>
</p>
<h2><a name="edit_subscriber_field">edit_subscriber_field</a></h2>
<pre>
 $lh-&gt;edit_subscriber_field(
        { 
                -old_name =&gt; 'old', 
                -new_name =&gt; 'new', 
                
        }
 );</pre>
<p>Changes the name of a Subscriber Field.</p>
<p>Returns 1 on success.</p>
<p><code>-old_name</code> holds the name of the field you want to rename.</p>
<p><code>-new_name</code> holds what you'd like to rename the field in <code>-old_name</code> to.</p>
<p>Both paramaters are required.</p>
<p>
</p>
<h3><a name="diagnostics">Diagnostics</a></h3>
<ul>
<li><strong><a name="you_must_supply_the_old_field_name_in_the_old_name_paramater" class="item">You MUST supply the old field name in the -old_name paramater!</a></strong>

<p>You forgot to pass the old field name.</p>
</li>
<li><strong><a name="you_must_supply_the_new_field_name_in_the_new_name_paramater" class="item">You MUST supply the new field name in the -new_name paramater!</a></strong>

<p>You forgot to pass the new field name.</p>
</li>
</ul>
<p>
</p>
<h2><a name="remove_subscriber_field">remove_subscriber_field</a></h2>
<pre>
 $lh-&gt;remove_subscriber_field(
        {
                -field =&gt; 'myfield', 
        },
 );</pre>
<p>Removes the field specified in, <code>-field</code>. <code>-field</code> is required.</p>
<p>Returns <code>1</code> upon success.</p>
<p>
</p>
<h3><a name="diagnostics">Diagnostics</a></h3>
<ul>
<li><strong><a name="you_must_pass_a_field_name_in_field" class="item">You MUST pass a field name in, -field!</a></strong>

<p>You forgot to set, <code>-field</code></p>
</li>
<li><strong><a name="cannot_do_statement_at_remove_subscriber_field" class="item">cannot do statement! (at: remove_subscriber_field)</a></strong>

<p>Something went wrong on the SQL side of things.</p>
</li>
</ul>
<p>
</p>
<h2><a name="subscriber_field_exists">subscriber_field_exists</a></h2>
<pre>
 my $exists = $lh-&gt;subscriber_field_exists(
        {
                -field =&gt; 'myfield', 
        }
 );</pre>
<p>Checks the existance of a subscriber field name.</p>
<p>
</p>
<h3><a name="diagnostics">Diagnostics</a></h3>
<ul>
<li><strong><a name="you_must_pass_a_field_name_in_field2" class="item">You MUST pass a field name in, -field!</a></strong>

<p>You forgot to set, <code>-field</code></p>
</li>
<li><strong><a name="cannot_do_statement_at_remove_subscriber_field2" class="item">cannot do statement! (at: remove_subscriber_field)</a></strong>

<p>Something went wrong on the SQL side of things.</p>
</li>
</ul>
<p>
</p>
<h2><a name="validate_subscriber_field_name">validate_subscriber_field_name</a></h2>
<pre>
 my ($status, $errors) = $lh-&gt;validate_subscriber_field_name(
                                                        {
                                                                -field =&gt; $field,
                                                                -skip  =&gt; [],
                                                        }
                                                );</pre>
<p>Used to validate a subscriber field name and meant to be used before a subscriber field is added.</p>
<p>Returns a two element array,</p>
<p>The first element is either <code>1</code> or <code>0</code> and is the status of the validation. A status of, <strong>1</strong>
means the validation was successful; <strong>0</strong> means the validation had problems.</p>
<p>The second element is a list of the errors that were found when validating, in the form of a hashref, with the name
of the error set as the key and the value set to, <strong>1</strong> if this error was found.</p>
<p><code>-field</code> is required and should be the name of the field you're attempting to validate.</p>
<p><code>-skip</code> is an optional paramater and is used to list the errors you're not so interested in. It should be set to an array ref.</p>
<p>
</p>
<h3><a name="subscriber_validation_requirements">Subscriber Validation Requirements</a></h3>
<p>Subscriber Profile Fields are validated mostly to make sure they're also valid SQL column names for all the SQL backends that are 
supported and also that the fields are not already used for internal SQL fields used by the program for other purposes. 
Validation is also done sparingly for reserved words.</p>
<p>The entire list of errors that can be reported back are as follows:</p>
<ul>
<li><strong><a name="field_blank" class="item">field_blank</a></strong>

<li><strong><a name="field_name_too_long" class="item">field_name_too_long</a></strong>

<p>length of 64</p>
</li>
<li><strong><a name="slashes_in_field_name" class="item">slashes_in_field_name</a></strong>

<p><code>/</code> or, <code>\</code></p>
</li>
<li><strong><a name="spaces" class="item">spaces</a></strong>

<li><strong><a name="weird_characters" class="item">weird_characters</a></strong>

<p>Basically anything that's not alpha/numeric</p>
</li>
<li><strong><a name="quotes" class="item">quotes</a></strong>

<p><code>'</code> and, <code>&quot;</code></p>
</li>
<li><strong><a name="field_exists" class="item">field_exists</a></strong>

<li><strong><a name="field_is_special_field" class="item">field_is_special_field</a></strong>

<p>The field name is one of the following:</p>
<ul>
<li><strong><a name="email_id" class="item">email_id</a></strong>

<li><strong>email</strong>

<li><strong>list</strong>

<li><strong><a name="list_type" class="item">list_type</a></strong>

<li><strong><a name="list_status" class="item">list_status</a></strong>

<li><strong><a name="email_name" class="item">email_name</a></strong>

<li><strong><a name="email_domain" class="item">email_domain</a></strong>

</ul>
</ul>
<p>
</p>
<h2><a name="validate_remove_subscriber_field_name">validate_remove_subscriber_field_name</a></h2>
<pre>
 my ($status, $errors) = $lh-&gt;validate_remove_subscriber_field_name(
                                                        { 
                                                                -field      =&gt; $field,
                                                                -skip       =&gt; [],
                                                                -die_for_me =&gt; 0, 
                                                        }
                                                );</pre>
<p>Similar to, <code>validate_subscriber_field_name</code> is used to validate a subscriber field name 
and is meant to be used before a subscriber field is <em>removed</em>.</p>
<p>Returns a two element array,</p>
<p>The first element is either <code>1</code> or <code>0</code> and is the status of the validation. A status of, <strong>1</strong>
means the validation was successful; <strong>0</strong> means the validation had problems.</p>
<p>The second element is a list of the errors that were found when validating, in the form of a hashref, with the name
of the error set as the key and the value set to, <strong>1</strong> if this error was found.</p>
<p><code>-field</code> is required and should be the name of the field you're attempting to validate.</p>
<p><code>-skip</code> is an optional paramater and is used to list the errors you're not so interested in. It should be set to an array ref.</p>
<p><code>-die_for_me</code> is another optional paramater. If set to, <code>1</code>, an error found in validation will prove fatal.</p>
<p>The entire list of errors that can be reported back are as follows:</p>
<ul>
<li><strong>field_is_special_field</strong>

<p>The field name is one of the following:</p>
<ul>
<li><strong>email_id</strong>

<li><strong>email</strong>

<li><strong>list</strong>

<li><strong>list_type</strong>

<li><strong>list_status</strong>

<li><strong>email_name</strong>

<li><strong>email_domain</strong>

</ul>
<li><strong>field_exists</strong>

<li><strong><a name="number_of_fields_limit_reached" class="item">number_of_fields_limit_reached</a></strong>

</ul>
<p>
</p>
<h2><a name="get_all_field_attributes">get_all_field_attributes</a></h2>
<pre>
 my $field_values = $lh-&gt;get_all_field_attributes;</pre>
<p>Returns the name of every subscriber field and its fallback value in the form of a hashref.</p>
<p>The fallback values are actually saved in the List Settings.</p>
<p>Take no arguments.</p>
<p>
</p>
<h2><a name="_save_field_attributes">_save_field_attributes</a></h2>
<pre>
 $lh-&gt;_save_field_attributes(
                {
                        -field          =&gt; $field, 
                        -fallback_value =&gt; $fallback_field_value, 
                }
 );</pre>
<p><strong>Currently marked as a private method</strong>.</p>
<p>Used to save a new fallback field value for the field set in, <code>-field</code>. <em>usually</em> shouldn't be used alone, but there is 
actually no way to edit a fallback field value, without using this method.</p>
<p>If used on an existing field, make sure to remove the fallback field value first, using, <code>_remove_field_attributes</code>, ala:</p>
<pre>
 $lh-&gt;remove_field_attributes({-field =&gt; 'myfield'});
 $lh-&gt;save_field_attributes({-field =&gt; 'myfield'}, -fallback_value =&gt; 'new_value');
 
Is called internally, when creating a new field via, C&lt;add_subscriber_field&gt;, so make sure not to call it twice.</pre>
<p>
</p>
<h3><a name="diagnostics">Diagnostics</a></h3>
<ul>
<li><strong><a name="you_must_pass_a_value_in_the_field_paramater" class="item">You MUST pass a value in the -field paramater!</a></strong>

</ul>
<p>
</p>
<h2><a name="remove_field_attributes">remove_field_attributes</a></h2>
<pre>
 $lh-&gt;remove_field_attributes(
                {
                        -field =&gt; 'myfield', 
                }
 );</pre>
<p><strong>Currently marked as a private method</strong>.</p>
<p>Used to remove a fallback field value. Used internally.</p>
<p>
</p>
<h3><a name="diagnostics">Diagnostics</a></h3>
<ul>
<li><strong><a name="you_must_pass_a_value_in_the_field_paramater2" class="item">You MUST pass a value in the -field paramater!</a></strong>

</ul>
<p>
</p>
<hr />
<h1><a name="author">AUTHOR</a></h1>
<p>Justin Simoni <a href="http://dadamailproject.com">http://dadamailproject.com</a></p>
<p>
</p>
<hr />
<h1><a name="licence_and_copyright">LICENCE AND COPYRIGHT</a></h1>
<p>Copyright (c) 1999 - 2012 Justin Simoni All rights reserved.</p>
<p>This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.</p>
<p>This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place - Suite 330, 
Boston, MA  02111-1307, USA.</p>

</body>

</html>
